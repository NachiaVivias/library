## Mo's algorithm

$[0,N)$上の区間に対する$Q$個のクエリを$\mathrm{O}(\alpha N \sqrt{Q})$で計算するライブラリ。(ただし区間の幅を$1$変化させる伸縮が$\mathrm{O}(\alpha)$で行えるとする。)

#### 概要

アルゴリズムは[snukeさんのブログ](https://snuke.hatenablog.com/entry/2016/07/01/000000)が詳しい。

考察ミスしていて定数倍を大きく悪くしていたので、反省を込めて定数倍について考察したものを簡単に記しておく。

区間の伸縮の計算量が(定数倍込みで)等しい時、アルゴリズムの実行時間は伸縮の回数に依存するので、伸縮の回数を最小化すれば実行時間が高速になると考えられる。そこで、ランダムなクエリに対して区間の伸縮回数を最小化する区間の分割幅$W$の値を考察する。左端と右端が動く回数は、

- 左端：1回あたり区間$[0,W]$上のランダムな$2$点の距離と等しいので$\frac{W}{3} \times Q$回
- 右端：$i$番目の区間を処理するとき$N - Wi$個動くので$\sum_{i \leq \frac{N}{W}} N-Wi = \frac{N^2}{2W}+\mathrm{O}(\frac{N}{W})$

であるので、$\frac{N^2}{2W} + \frac{WQ}{3}$が最小になる$W$を選べばよく、AM-BMより$W=\frac{\sqrt{3}N}{\sqrt{2Q}}$を得る。

(修正前のライブラリはうっかり$W=\frac{\sqrt{3}N}{\sqrt{Q}}$にしていたがこれだと定数倍が$3$倍ほど悪いようだ。これはひどい…)